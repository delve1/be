<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>index</title>
    <link rel="stylesheet" href="css/index.css">
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="js/mqttws31.js" type="text/javascript"></script>
    <style>
        .box {
            width: 80%;
            float: left;
            margin: 0 20px 0 20px;
        }
  
        .box div, .box input {
            border: 1px solid;
            -moz-border-radius: 4px;
            border-radius: 4px;
            width: 100%;
            padding: 5px;
            margin: 3px 0 10px 0;
        }
  
        .box div {
            border-color: grey;
            height: 800px;
            overflow: auto;
        }
  
        div code {
            display: block;
        }
        #first {
            color:white;
        }
        #first div code {
            margin:0 0 10px 10px;
            font-size: 15px;
        }
  
        #second div {
            font-size: 0.8em;
        }
    </style>
</head>
<body>
	<div class="box">
		<div sec:authorize="isAuthenticated()">
			<a sec:authentication="name" th:href="@{/user/info}"></a> 님 로그인중
			<a th:href="@{/user/logout}">로그아웃</a>
		</div>
		<div sec:authorize="!isAuthenticated()">
			<a th:href="@{/user/signup_form}">회원가입</a>
			<a th:href="@{/user/loginform}">로그인</a>
		</div>
	</div>
    <div class="container">
        <nav class="serverList">
            <ul>
                <div class="listItem userProfile">
                    <div class="wrapper">
                        <span class="item"></span>
                        <div class="user_wrapper">
                            <svg aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M19.73 4.87a18.2 18.2 0 0 0-4.6-1.44c-.21.4-.4.8-.58 1.21-1.69-.25-3.4-.25-5.1 0-.18-.41-.37-.82-.59-1.2-1.6.27-3.14.75-4.6 1.43A19.04 19.04 0 0 0 .96 17.7a18.43 18.43 0 0 0 5.63 2.87c.46-.62.86-1.28 1.2-1.98-.65-.25-1.29-.55-1.9-.92.17-.12.32-.24.47-.37 3.58 1.7 7.7 1.7 11.28 0l.46.37c-.6.36-1.25.67-1.9.92.35.7.75 1.35 1.2 1.98 2.03-.63 3.94-1.6 5.64-2.87.47-4.87-.78-9.09-3.3-12.83ZM8.3 15.12c-1.1 0-2-1.02-2-2.27 0-1.24.88-2.26 2-2.26s2.02 1.02 2 2.26c0 1.25-.89 2.27-2 2.27Zm7.4 0c-1.1 0-2-1.02-2-2.27 0-1.24.88-2.26 2-2.26s2.02 1.02 2 2.26c0 1.25-.88 2.27-2 2.27Z" class=""></path></svg>
                        </div>
                    </div>
                </div>
                <span class="line"></span>
                <div class="listItem" >
                    <div class="wrapper">
                        <span class="item"></span>
                        <div class="pro_wrapper">
                            <img class="serverImg" src="img/server1.jpg" alt="">
                        </div>
                      	
                    </div>
                </div>
                <div class="listItem">
                    <div class="wrapper">
                        <span class="item"></span>
                        <div class="pro_wrapper">
                            <img class="serverImg" src="img/server1.jpg" alt="">
                        </div>
                    </div>
                </div>
                <div class="listItem">
                    <div class="wrapper">
                        <span class="item"></span>
                        <div class="pro_wrapper">
                            <img class="serverImg" src="img/server1.jpg" alt="">
                        </div>
                    </div>
                </div>
                <div class="listItem serverAddBtn">
                    <div class="wrapper">
                        <span class="item"></span>
                        <div class="user_wrapper">
                            <svg class="circleIcon__428dd" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M13 5a1 1 0 1 0-2 0v6H5a1 1 0 1 0 0 2h6v6a1 1 0 1 0 2 0v-6h6a1 1 0 1 0 0-2h-6V5Z" class=""></path></svg>
                        </div>
                    </div>
                </div>
            </ul>
        </nav>
        <nav class="channelList">
            <header class="header">
                <div class="headerContent">
                    <div class="guildIcon">
                        
                    </div>
                    <div class="content">
                        서버이름
                    </div>
                    <div class="headerChildren__7cd0b">
                        
                    </div>
                </div>
            </header>
            <ul class="channerDetail">
                <li>
                    <div class="link1">채널 훑어보기</div>
                </li>
                <li>
                    <div class="link2">멤버</div>
                </li>
                
                <li>
                    <div class="category1">정보</div>
                </li>
                <li>
                    <div class="channel">#채널1</div>
                </li>
                <li>
                    <div class="channel">#채널1</div>
                </li>
                <li>
                    <div class="channel">#채널1</div>
                </li>

                <li>
                    <div class="category1">채팅 채널</div>
                </li>
                <li>
                    <div class="channel">#채널1</div>
                </li>
                <li>
                    <div class="channel">#채널1</div>
                </li>
                <li>
                    <div class="channel">#채널1</div>
                </li>
            </ul>
            <div class="userProWrapper">
                <div class="userPro">
                    <div class="profile1">
                        <div class="user_wrapper">
                            <a th:href="@{/login}">
								<svg aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M19.73 4.87a18.2 18.2 0 0 0-4.6-1.44c-.21.4-.4.8-.58 1.21-1.69-.25-3.4-.25-5.1 0-.18-.41-.37-.82-.59-1.2-1.6.27-3.14.75-4.6 1.43A19.04 19.04 0 0 0 .96 17.7a18.43 18.43 0 0 0 5.63 2.87c.46-.62.86-1.28 1.2-1.98-.65-.25-1.29-.55-1.9-.92.17-.12.32-.24.47-.37 3.58 1.7 7.7 1.7 11.28 0l.46.37c-.6.36-1.25.67-1.9.92.35.7.75 1.35 1.2 1.98 2.03-.63 3.94-1.6 5.64-2.87.47-4.87-.78-9.09-3.3-12.83ZM8.3 15.12c-1.1 0-2-1.02-2-2.27 0-1.24.88-2.26 2-2.26s2.02 1.02 2 2.26c0 1.25-.89 2.27-2 2.27Zm7.4 0c-1.1 0-2-1.02-2-2.27 0-1.24.88-2.26 2-2.26s2.02 1.02 2 2.26c0 1.25-.88 2.27-2 2.27Z" class=""></path></svg>
							</a>                            
                        </div>
                        <div class="info">
                            <div class="name">블라블</div>
                            <span class="nick">ss_On</span>
                        </div>
                    </div>
                </div>
                <div class="mike"><svg aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24"><path fill="var(--status-danger)" d="m2.7 22.7 20-20a1 1 0 0 0-1.4-1.4l-20 20a1 1 0 1 0 1.4 1.4ZM10.8 17.32c-.21.21-.1.58.2.62V20H9a1 1 0 1 0 0 2h6a1 1 0 1 0 0-2h-2v-2.06A8 8 0 0 0 20 10a1 1 0 0 0-2 0c0 1.45-.52 2.79-1.38 3.83l-.02.02A5.99 5.99 0 0 1 12.32 16a.52.52 0 0 0-.34.15l-1.18 1.18ZM15.36 4.52c.15-.15.19-.38.08-.56A4 4 0 0 0 8 6v4c0 .3.03.58.1.86.07.34.49.43.74.18l6.52-6.52ZM5.06 13.98c.16.28.53.31.75.09l.75-.75c.16-.16.19-.4.08-.61A5.97 5.97 0 0 1 6 10a1 1 0 0 0-2 0c0 1.45.39 2.81 1.06 3.98Z" class=""></path></svg></div>
                <div class="headset"></div>
                <div class="settings"></div>
            </div>
        </nav>
        <div class="chat">
            <div id="first" class="box">
                <h2>채팅내역</h2>
                <div></div>
                <form><input autocomplete="off" value="Type here..."></input></form>
            </div>
        </div>
    </div>
</body>
<script>
    var has_had_focus = false;
    var pipe = function(el_name, send) {
        var div  = $(el_name + ' div');
        var inp  = $(el_name + ' input');
        var form = $(el_name + ' form');

        var print = function(m, p) {
            p = (p === undefined) ? '' : JSON.stringify(p);
            div.append($("<code>").text(m + ' ' + p));
            div.scrollTop(div.scrollTop() + 10000);
        };

        if (send) {
            form.submit(function() {
                send(inp.val());
                inp.val('');
                return false;
            });
        }
        return print;
    };

    var print_first = pipe('#first', function(data) {
        message = new Paho.MQTT.Message(data);
        message.destinationName = "test";
        debug("SEND ON " + message.destinationName + " PAYLOAD " + data);
        client.send(message);
    });

    var debug = pipe('#second');

    var wsbroker = location.hostname;  //mqtt websocket enabled broker
    var wsport = 15675; // port for above

    var client = new Paho.MQTT.Client(wsbroker, wsport, "/ws",
        "myclientid_" + parseInt(Math.random() * 100, 10));

    client.onConnectionLost = function (responseObject) {
        debug("CONNECTION LOST - " + responseObject.errorMessage);
    };

    client.onMessageArrived = function (message) {
        debug("RECEIVE ON " + message.destinationName + " PAYLOAD " + message.payloadString);
        print_first(message.payloadString);
    };

    var options = {
        timeout: 3,
        keepAliveInterval: 30,
        onSuccess: function () {
            debug("CONNECTION SUCCESS");
            client.subscribe("test", {qos: 1});
        },
        onFailure: function (message) {
            debug("CONNECTION FAILURE - " + message.errorMessage);
        }
    };

    if (location.protocol == "https:") {
        options.useSSL = true;
    }

    debug("CONNECT TO " + wsbroker + ":" + wsport);
    client.connect(options);

    $('#first input').focus(function() {
        if (!has_had_focus) {
            has_had_focus = true;
            $(this).val("");
        }
    });
</script>
</html>
